<template>
  <div>

    <div class="header">
      <div class="container">
      <div class="row">
        <div class="col-md-4 col-sm-5 nav-link text-center">
          <router-link to="/">
            <img src="~/static/cow.svg" class="logo"/>
          </router-link>
        </div>
        <div class="col-md-4 text-center nav-container">
          <b-nav class="justify-content-center">
            <b-nav-item>
              <router-link to="/">
                {{$t("navbar.home")}}
              </router-link>
            </b-nav-item> 
            <b-nav-item>
              <router-link to="/airdrop">
                {{$t("navbar.airdrop")}}
              </router-link>
            </b-nav-item> 
            <b-nav-item>
              <router-link to="/about">
                {{$t("navbar.about")}}
              </router-link>
            </b-nav-item> 
          </b-nav>
        </div>
        <div class="col-md-4 col-sm-5 text-right nav-link right">
          <div class="wallet" v-if="walletInstalled">
            <span v-if="checkChainId()">
              <span class="addr" v-if="connectedAccount">
              <b-icon-wallet></b-icon-wallet>
              {{ shortAddr(connectedAccount) }}</span>
            </span>
            <a href="https://docs.binance.org/smart-chain/wallet/metamask.html" target="_blank" v-else>{{$t("navbar.change-to-bsc")}}</a>
          </div>
          <div v-else><a href="https://metamask.io/" target="_blank">{{$t("navbar.install-wallet")}}</a></div>
          <b-dropdown class="dropdown" :text="currentLang == 'en' ? language.en : language.zh_CN">
              <b-dropdown-item @click="checkLanguage('en')" :active="currentLang == 'en'">{{language.en}}</b-dropdown-item>
              <b-dropdown-item @click="checkLanguage('zh_CN')" :active="currentLang == 'zh_CN'">{{language.zh_CN}}</b-dropdown-item>
          </b-dropdown>
        </div>
      </div>
      </div>
    </div>

    <div class="container main">
      <b-row>
        <b-col cols="2" class="d-none d-sm-block"></b-col>
        <b-col md="8" sm="12" >
          <nuxt />
        </b-col>
        <b-col cols="2" class="d-none d-sm-block"></b-col>
      </b-row>
    </div>

    <div class="footer">
      <div class="footer-body">
        <a href="https://twitter.com/StakeCow" class="link" target="_blank">{{$t("footerbar.twitter")}}</a>
        <a href="https://t.me/StakeCow" class="link" target="_blank">{{$t("footerbar.telegram")}}</a>
        <a href="https://github.com/milk-protocol" class="link" target="_blank">{{$t("footerbar.github")}}</a>
      </div>
    </div>
  </div>
</template>

<script>
  import utils from '~/mixins/utils'
  import config from '~/config'
  export default {
    data () {
      return {
        connectedAccount: '',
        chainId: 0,
        walletInstalled: true,
        language: {
          en: "English",
          zh_CN: "简体中文"
        }
      }
    },
    computed: {
      currentLang(){
        return  this.$store.state.locale
      }
    },
    methods: {
      checkLanguage(lang){
        this.$i18n.locale = lang
        this.$store.commit('updateLang', lang)
      },
      checkChainId() {
        return config.chainId == this.chainId
      },
      shortAddr(addr) {
        return utils.shortAddr(addr)
      },
      async onConnect() {
        this.walletInstalled = !!window.ethereum;
        if(window.ethereum) {
          window.ethereum.on('accountsChanged', function (accounts) {
            this.connectedAccount = accounts[0];
            this.chainId = web3.toBigNumber(window.ethereum.chainId).toNumber();
          });
          if(!window.web3.eth.defaultAccount) {
            await window.ethereum.enable();
          }
          this.connectedAccount = window.connectedAccount = window.web3.eth.defaultAccount;
          this.chainId = web3.toBigNumber(window.ethereum.chainId).toNumber();
        }
      },
      async onUnlock() {
        await this.onConnect()
      }
    },
    async mounted() {
      await this.onConnect();
    }
  }
</script>


<style>
  .header {
    background-color: #28a745;
    padding: 0.5rem;
    margin-bottom: 2rem;
    color: #fff;
  }
  .header a {
    color: #fff;
    font-size: 1.1rem;
  }
  .nav-container{
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .wallet {
    /* float: right; */
  }

  .logo {
    padding: 0;
    height: 32px;
  }
  .main {
    min-height: calc(100vh - 144px);
  }

  .footer {

  }
  .footer-body{
    -webkit-box-align: center;
    align-items: center;
    display: flex;
    -webkit-box-pack: center;
    justify-content: center;
    height: 72px;
    width: 100%;
  }
  .support img{
    height: 16px;
  }
  .link {
    margin: 0 1rem;
  }
  .right{
    display:flex;
    justify-content:flex-end;
    align-items: center;
  }
  .wallet {
    font-weight: bold;
    cursor: pointer;
  }

  .dropdown .btn.dropdown-toggle{
    /* line-height:1; */
    margin-left: 20px;
    padding: 0;
    background-color: transparent;
    color: #fff;
    font-size: 1.1rem;
    border: none;
    outline: none;
  }
  .dropdown .btn.dropdown-toggle:focus, .dropdown .btn.dropdown-toggle:active{
    border-color: transparent;
    background-color: transparent;
  }
  .dropdown-item.active{
    color: #28a745;
    background-color: transparent;
  }
  .dropdown-item:active{
    color: black;
    background-color: transparent;
  }
  .dropdown-menu a{
    color: #16181b;
  }

</style>
